<nav class="mx-auto w-full mt-4 max-w-[1200px] px-5">
    <ul class="flex items-center">
        <li class="cursor-pointer">
            <a href="index.html">
            <svg
                xmlns="http://www.w3.org/2000/svg"
                viewBox="0 0 24 24"
                fill="currentColor"
                class="h-5 w-5"
            >
                <path
                d="M11.47 3.84a.75.75 0 011.06 0l8.69 8.69a.75.75 0 101.06-1.06l-8.689-8.69a2.25 2.25 0 00-3.182 0l-8.69 8.69a.75.75 0 001.061 1.06l8.69-8.69z"
                />
                <path
                d="M12 5.432l8.159 8.159c.03.03.06.058.091.086v6.198c0 1.035-.84 1.875-1.875 1.875H15a.75.75 0 01-.75-.75v-4.5a.75.75 0 00-.75-.75h-3a.75.75 0 00-.75.75V21a.75.75 0 01-.75.75H5.625a1.875 1.875 0 01-1.875-1.875v-6.198a2.29 2.29 0 00.091-.086L12 5.43z"
                />
            </svg>
            </a>
        </li>
        <li>
            <span class="mx-2 text-gray-500">&gt;</span>
        </li>

        <li class="text-gray-500">Checkout</li>
    </ul>
</nav>

    
<form
    action="/order/create" 
    method="POST"
    class="container mx-auto max-w-[1200px] py-5 lg:flex lg:flex-col lg:py-10"
>
    
    <h2 class="mx-auto px-5 text-2xl font-bold ">
        Complete Address
    </h2>
    <!-- Address form -->
    <section
    class="grid w-full max-w-[1200px] grid-cols-1 gap-3 px-5 pb-10"
    >   

        <div class="py-5">
            <div class="flex w-full flex-col gap-3" action="">
                <div class="flex w-full justify-between gap-2">
                    <div class="flex w-1/2 flex-col">
                    <label class="flex" for="name">Name
                        <span class="block text-sm font-medium text-slate-700 after:ml-0.5 after:text-red-500 after:content-['*']">
                        </span>
                    </label>
                    <input
                        class="w-full border px-4 py-2 outline-yellow-400"
                        type="text"
                        placeholder="Your name"
                        name="name"
                        required
                    />
                    </div>

                    <div class="flex w-1/2 flex-col">
                    <label class="flex" for="email">Email Address
                        <span class="block text-sm font-medium text-slate-700 after:ml-0.5 after:text-red-500 after:content-['*']">
                        </span>
                    </label>
                    <input
                        class="w-full border px-4 py-2 outline-yellow-400"
                        type="email"
                        placeholder="Your email"
                        name="email"
                        required
                    />
                    </div>
                </div>

                <div class="flex flex-col">
                    <label class="flex" for="address">Address
                    <span
                        class="block text-sm font-medium text-slate-700 after:ml-0.5 after:text-red-500 after:content-['*']"
                    >
                    </span>
                    </label>
                    <textarea
                    class="border px-4 py-2 outline-yellow-400"
                    type="text"
                    name="address"
                    required
                    ></textarea>
                </div>

                <div class="flex flex-col">
                    <label for="">Commentary</label>
                    <textarea
                    class="border px-4 py-2 outline-yellow-400"
                    type="text"
                    name="comment"
                    ></textarea>
                </div>
            </div>
        </div>     
    </section>
    
    <!-- Dilivery method -->
    <h2 class="mx-auto px-5 text-2xl font-bold ">
        Delivery Method
    </h2>

    <section
        class="grid w-full max-w-[1200px] grid-cols-1 gap-3 px-5 pb-10"
    >
        <div class="py-5">
            
            <div
                class="grid w-full grid-cols-1 gap-3 lg:grid-cols-2"
            >
                {{#each deliveryMethods}}
                <div class="flex w-full justify-between gap-2">
                    <div class="flex w-full cursor-pointer flex-col border">
                        <div class="flex bg-amber-400 px-4 py-2">
                            <input 
                            class="outline-yellow-400" 
                            type="radio" 
                            name="deliveryMethod"
                            value="{{this.name}}"
                            id="{{this.name}}"
                            data-fee="{{this.cost}}"
                            required
                            />
                            <p class="ml-3 font-bold">{{this.name}}</p>
                        </div>
                        <div class="px-4 py-3">
                            <p class="pb-3 font-bold text-violet-900">{{this.cost}}VND</p>
                            <p class="text-sm">
                                {{this.description}}
                            </p>
                        </div>
                    </div>
                </div>
                {{/each}}
            </div>
        </div>
    </section>
    <!-- Payment method -->
    <h2 class="mx-auto px-5 text-2xl font-bold ">
        Payment Method 
    </h2>

    <section
        class="grid w-full max-w-[1200px] grid-cols-1 gap-3 px-5 pb-10"
    >

        <div class="py-5">
            <div class="flex w-full flex-col gap-3" action="">
            <div class="flex w-full flex-col">
                <label class="flex" for="cardNumber">Payment Card Number
                    <span class="block text-sm font-medium text-slate-700 after:ml-0.5 after:text-red-500 after:content-['*']">
                    </span>
                </label>
                <input
                x-mask="**** **** **** ****"
                class="w-full border px-4 py-2"
                placeholder="XXXX XXXX XXXX XXXX"
                name="cardNumber"
                required
                />
            </div>

            <div class="flex w-full flex-col">
                <label class="flex" for="cardHolder">Card Holder
                    <span class="block text-sm font-medium text-slate-700 after:ml-0.5 after:text-red-500 after:content-['*']">
                    </span>
                </label>
                <input
                class="w-full border px-4 py-2"
                type="text"
                placeholder="Your Name"
                name="cardHolder"
                required
                />
            </div>

            <div class="flex items-center gap-5">
                <div class="flex flex-col">
                <label class="flex" for="cardExpire">Expiry Date
                    <span class="block text-sm font-medium text-slate-700 after:ml-0.5 after:text-red-500 after:content-['*']">
                    </span>
                </label>

                <div class="flex w-[150px] items-center gap-1">
                    <input
                    x-mask="99"
                    class="w-full border px-4 py-2 text-center"
                    name="cardExpire"
                    placeholder="MM/YY"
                    required
                    />
                </div>
                </div>

                <div class="flex flex-col w-[60px] lg:w-[120px]">
                <label class="flex" for="cardCVV">CVV/CVC
                    <span class="block text-sm font-medium text-slate-700 after:ml-0.5 after:text-red-500 after:content-['*']">
                    </span>
                </label>
                <input
                    x-mask="999"
                    class="w-full border py-2 text-center"
                    type="password"
                    placeholder="&bull;&bull;&bull;"
                    name="cardCVV"
                    required
                />
                </div>
            </div>
            </div>
        </div>
    </section>
    <!-- Order review-->
    <!-- Mobile -->
    <section
          class="container mx-auto my-3 flex w-full flex-col gap-3 px-4 md:hidden"
        >
        
        {{#each cartItems}}
        <div class="flex w-full border px-4 py-4">
            <img
                class="self-start object-contain"
                width="90px"
                src={{this.Product.imageUrl}}
                alt={{this.Product.name}}
            />
            <div class="ml-3 flex w-full flex-col justify-center">
                <div class="flex items-center justify-between">
                    <p class="text-xl font-bold">{{this.Product.name}}</p>
                    <svg
                        xmlns="http://www.w3.org/2000/svg"
                        viewBox="0 0 20 20"
                        fill="currentColor"
                        class="h-5 w-5"
                    >
                        <path
                            d="M10 3a1.5 1.5 0 110 3 1.5 1.5 0 010-3zM10 8.5a1.5 1.5 0 110 3 1.5 1.5 0 010-3zM11.5 15.5a1.5 1.5 0 10-3 0 1.5 1.5 0 003 0z"
                        />
                    </svg>
                </div>
                <p class="py-3 text-xl font-bold text-violet-900 product-total">{{multiply this.Product.discountedPrice this.quantity}}</p>
                <div class="mt-2 flex w-full items-center justify-between">
                    <div class="flex items-center justify-center">                        
                        <div
                            class="flex h-8 w-8 cursor-text items-center justify-center border-t border-b active:ring-gray-500"
                        >
                            {{this.quantity}}
                        </div>                       
                    </div>
                </div>
            </div>
        </div>
        {{/each}}
    </section>

    <!-- Desktop -->
    <section
        class="hidden h-[600px] w-full max-w-[1200px] grid-cols-1 gap-3 px-5 pb-10 md:grid"
    >
        <table class="table-fixed">
        <thead class="h-16 bg-neutral-100">
            <tr>
            <th>ITEM</th>
            <th>PRICE</th>
            <th>QUANTITY</th>
            <th>TOTAL</th>
            <th></th>
            </tr>
        </thead>
        <tbody>
            {{#each cartItems}}
            <tr class="h-[100px] border-b">
            <td class="align-middle">
                <div class="flex">
                <img
                    class="w-[90px]"
                    src={{this.Product.imageUrl}}
                    alt={{this.Product.name}}
                />
                <div class="ml-3 flex flex-col justify-center">
                    <p class="text-xl font-bold">{{this.Product.name}}</p>
                </div>
                </div>
            </td>
            <td class="mx-auto text-center product-price">{{this.Product.discountedPrice}}</td>
            <td class="align-middle">
                <div class="flex items-center justify-center">               
                    <div
                        class="flex h-8 w-8 cursor-text items-center justify-center border-t border-b active:ring-gray-500"
                    >
                        {{this.quantity}}
                    </div>                
                </div>
            </td>
            <td class="mx-auto text-center product-total">{{multiply this.Product.discountedPrice this.quantity}}</td>
            </tr>
            {{/each}}
        </tbody>
        </table>
    </section>

    <!-- Order summary -->
    <section class="mx-auto w-full px-4 md:max-w-[400px]">
    <div class="">
        <div class="border py-5 px-4 shadow-md">
        <p class="font-bold">ORDER SUMMARY</p>

        <div class="flex justify-between border-b py-5">
            <p>Subtotal</p>
            <p><span id="subtotal">{{subtotal}}</span> VND</p>
        </div>

        <div class="flex justify-between border-b py-5">
            <p>Shipping</p>
            <p><span id="shippingFee">0</span> VND</p>
        </div>

        <div class="flex justify-between py-5">
            <p>Total</p>
            <p><span  id="totalAmount">{{subtotal}}</span> VND</p>
        </div>
        </div>
    </div>
    </section>

    <!-- Confirm order -->
    <div class="flex w-full items-center justify-between mt-8">
        <a href="/cart" class="text-sm text-violet-900">
            &larr; Back to the cart
        </a>

        <button type="submit" class="bg-amber-400 px-4 py-2">
            Place an order
        </button>
    </div>
</form>

<script>
    const formatNumber = (number) => {
        return number.toLocaleString("en-US");
    };

    // Format single product prices
    document.querySelectorAll('.product-price').forEach(priceElement => {
        const price = parseFloat(priceElement.textContent.replace(/[^0-9.-]+/g, ''));
        priceElement.textContent = formatNumber(price) + " VND";
    });

    // Format total product prices
    document.querySelectorAll('.product-total').forEach(totalElement => {
        const total = parseFloat(totalElement.textContent.replace(/[^0-9.-]+/g, ''));
        totalElement.textContent = formatNumber(total) + " VND";
    });

    // Format subtotal, shipping fee, and total dynamically
    const deliveryOptions = document.querySelectorAll('input[name="deliveryMethod"]');
    const shippingFeeElement = document.getElementById('shippingFee');
    const totalAmountElement = document.getElementById('totalAmount');
    const subtotal = parseFloat(document.getElementById('subtotal').textContent.replace(/,/g, ''));

    deliveryOptions.forEach(option => {
        option.addEventListener('change', (e) => {
            const fee = parseFloat(e.target.dataset.fee) || 0;
            shippingFeeElement.textContent = formatNumber(fee);
            totalAmountElement.textContent = formatNumber(subtotal + fee);
        });
    });
</script>


